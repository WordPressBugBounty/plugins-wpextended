class WPExtendedDuplicatePostEditor extends WPExtendedDuplicatePost{constructor(){super(),this.config=window.wpextDuplicatePost,this.toolbarSelector=".editor-header__toolbar",this.init()}init(){this.setupEditorSubscription()}setupEditorSubscription(){const t=wp.data.subscribe((()=>{const e=!1===wp.data.select("core/editor")?.isCleanNewPost(),i=document.querySelector(this.toolbarSelector);e&&i&&(this.insertButton(),t())}))}insertButton(){const t=document.querySelector(this.toolbarSelector);if(!t)return;if(document.querySelector(".wpext-duplicate-post"))return;const e=document.createElement("button");e.className="components-button is-secondary wpext-duplicate-post",e.innerHTML=this.config.i18n.duplicate,e.style.marginLeft="8px",e.addEventListener("click",(()=>{this.handleDuplicate(e)})),t.appendChild(e)}setLoadingState(t,e){if(t){if(e)return t.classList.add("is-busy"),t.disabled=!0,void(t.innerHTML=this.config.i18n.duplicating);t.classList.remove("is-busy"),t.disabled=!1,t.innerHTML=this.config.i18n.duplicate}}async handleDuplicate(t){const e=wp.data.select("core/editor").getCurrentPostId();if(e){this.setLoadingState(t,!0);try{const t=await this.duplicatePost(e);await this.handleSuccessfulDuplication(t)}catch(t){console.error("WPExtended: Duplication error",t),this.handleDuplicationError(t)}finally{this.setLoadingState(t,!1)}}else console.warn("WPExtended: No post ID found")}async duplicatePost(t){if(!t)throw Error(this.config.i18n.errorInvalid);const e=await wp.apiFetch({path:`${this.config.root}/duplicate-post/duplicate/${t}`,method:"POST",headers:{"X-WP-Nonce":this.config.nonce}});if(!e||!e.id)throw Error(this.config.i18n.errorInvalid);return e}async handleSuccessfulDuplication(t){t&&(wp.data.dispatch("core/notices").createSuccessNotice(this.config.i18n.success,{type:"snackbar",isDismissible:!0}),await new Promise((t=>setTimeout(t,500))),"1"===this.config.postRedirect&&(window.location.href=t.edit_url))}handleDuplicationError(t){t&&wp.data.dispatch("core/notices").createErrorNotice(t.message||this.config.i18n.error,{type:"snackbar",isDismissible:!0})}}void 0!==window.wpextDuplicatePost&&window.wpextDuplicatePost.isEditScreen&&(window.duplicatePost=new WPExtendedDuplicatePostEditor);