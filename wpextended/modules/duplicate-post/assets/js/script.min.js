void 0!==window.wpextDuplicatePost&&(window.duplicatePost=new class{constructor(){this.config=window.wpextDuplicatePost,console.log(this.config),this.init()}init(){this.config.isEditScreen?!this.config.isEditScreen||this.config.isBlockEditor||this.setupClassicEditor():this.setupListPage()}setupListPage(){document.querySelectorAll(".wpext-duplicate-post").forEach((t=>{t.addEventListener("click",(i=>{i.preventDefault(),this.handleDuplicate(t)}))}))}setupClassicEditor(){const t=setInterval((()=>{const i=document.querySelector(".page-title-action");i&&(clearInterval(t),this.insertClassicEditorButton(i))}),100)}insertClassicEditorButton(t){if(document.querySelector(".wpext-duplicate-post"))return;const i=document.createElement("a");i.className="page-title-action wpext-duplicate-post",i.innerHTML=this.config.i18n.duplicate,i.style.marginLeft="4px",i.addEventListener("click",(t=>{t.preventDefault(),this.handleDuplicate(i)})),t.parentNode.insertBefore(i,t.nextSibling)}setupEventListeners(){document.addEventListener("click",(async t=>{const i=t.target.closest(".wpext-duplicate-post");i&&(t.preventDefault(),await this.handleDuplicate(i))}))}async handleDuplicate(t){const i=t.dataset.id;if(i){this.setLoadingState(t,!0);try{const t=await this.duplicatePost(i);await this.handleSuccessfulDuplication(t)}catch(t){this.handleDuplicationError(t)}finally{this.setLoadingState(t,!1)}}}setLoadingState(t,i){if(t){if(i)return t.classList.add("updating-message"),t.disabled=!0,void(t.innerHTML=this.config.i18n.duplicating);t.classList.remove("updating-message"),t.disabled=!1,t.innerHTML=this.config.i18n.duplicate}}async duplicatePost(t){if(!t)throw Error(this.config.i18n.errorInvalid);const i=await wp.apiFetch({path:`${this.config.root}/duplicate-post/duplicate/${t}`,method:"POST",headers:{"X-WP-Nonce":this.config.nonce}});if(!i||!i.id)throw Error(this.config.i18n.errorInvalid);return i}async handleSuccessfulDuplication(t){t&&(!this.config.isBlockEditor&&window.notify&&window.notify.success(this.config.i18n.success,{duration:3e3}),await new Promise((t=>setTimeout(t,500))),1!==this.config.postRedirect?this.config.isEditScreen||window.location.reload():window.location.href=t.edit_url)}handleDuplicationError(t){if(t&&!this.config.isBlockEditor){if(window.notify)return void window.notify.error(t.message||this.config.i18n.error,{duration:5e3});alert(t.message||this.config.i18n.error)}}});