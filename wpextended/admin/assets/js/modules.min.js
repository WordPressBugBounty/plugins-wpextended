!function($){"use strict";const e={selectors:{module:".wpext-module",noModules:".wpext-no-modules",liveRegion:".wpext-live-region",search:"#module-search",searchClear:".wpext-module-filters__search-clear",status:"#module-status",layoutButtons:".wpext-module-filters__layout-button",modulesContainer:".wpext-modules",groupNav:'.wpext-nav[data-type="groups"]',checkbox:".wpext-module__checkbox",toggle:".wpext-module__toggle",notices:".wpext-notices",currentCount:".wpext-module-filters__current-count",totalCount:".wpext-module-filters__total-count"},classes:{active:"active",navItemActive:"wpext-nav__item--active",modulesPro:"wpext-module--pro",grid:"wpext-modules--grid",list:"wpext-modules--list",moduleActive:"wpext-module--active",fadeOut:"wpext-module--fade-out",fadeIn:"wpext-module--fade-in"},storageKeys:{settings:"wpextModuleSettings"},init(){this.$els={modules:$(this.selectors.module),noModules:$(this.selectors.noModules),liveRegion:$(this.selectors.liveRegion),search:$(this.selectors.search),searchClear:$(this.selectors.searchClear),status:$(this.selectors.status),layoutButtons:$(this.selectors.layoutButtons),modulesContainer:$(this.selectors.modulesContainer),groupNav:$(this.selectors.groupNav),notices:$(this.selectors.notices),currentCount:$(this.selectors.currentCount),totalCount:$(this.selectors.totalCount)},this.$els.modules.length&&(this.currentCategory="modules",this.currentGroup=this.getInitialGroup(),this.searchTimeout=null,this.restoreFilters(),this.bindEvents(),this.restoreLayout(),this.updateGroupUI(),this.applyFilters(),this.toggleSearchClear())},bindEvents(){this.$els.search.on("input",(()=>{this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout((()=>{this.saveFilters(),this.applyFilters(),this.toggleSearchClear()}),300)})),$(document).on("click",this.selectors.searchClear,(()=>{this.searchTimeout&&clearTimeout(this.searchTimeout),this.$els.search.val("").trigger("input").focus()})),this.$els.status.on("change",(()=>{const e=new URLSearchParams(window.location.search).get("status"),t=this.$els.status.val();if(e&&t!==e){const e=new URL(window.location.href);e.searchParams.delete("status"),window.history.replaceState({},"",e)}this.saveFilters(),this.applyFilters()})),this.$els.layoutButtons.on("click",(e=>this.handleLayoutToggle(e))),this.$els.groupNav.find(".wpext-nav__item-link").on("click",(e=>this.handleGroupClick(e))),$(document).on("change",this.selectors.toggle,(e=>this.handleModuleToggle(e))),window.addEventListener("popstate",(()=>{this.currentGroup=this.getInitialGroup(),this.updateGroupUI(),this.applyFilters()}))},handleModuleToggle(e){const t=$(e.currentTarget),s=t.closest(this.selectors.module),o=t.find("input").val(),a=t.find("input"),i=a.prop("checked");a.prop("disabled",!0),fetch(`${wpextended_modules.root}wpextended/v1/modules/${o}/toggle`,{method:"POST",headers:{"X-WP-Nonce":wpextended_modules.nonce,"Content-Type":"application/json"},body:JSON.stringify({enabled:i})}).then((async e=>{const t=await e.json();if(!e.ok)throw t;t.success&&(s.toggleClass(this.classes.moduleActive,t.enabled),a.prop("checked",t.enabled),a.prop("disabled",!1),window.notify.success(t.message))})).catch((e=>{const t=e.message||"An error occurred while updating the module.";window.notify.error(t,{persistent:!0}),setTimeout((()=>{a.prop("checked",!i),a.prop("disabled",!1)}),750)}))},getInitialGroup(){return new URLSearchParams(window.location.search).get("group")||this.getStoredSettings().group||"all-modules"},getStoredSettings(){const e=localStorage.getItem(this.storageKeys.settings);return e?JSON.parse(e):{}},saveFilters(){const e={...this.getStoredSettings(),search:this.$els.search.val(),status:this.$els.status.val(),group:this.currentGroup};localStorage.setItem(this.storageKeys.settings,JSON.stringify(e))},restoreFilters(){const e=this.getStoredSettings(),t=new URLSearchParams(window.location.search),s=t.get("status"),o=t.get("search"),a=t.get("group"),i={...e};s?(this.$els.status.val(s),i.status=s):e.status&&this.$els.status.val(e.status),o?(this.$els.search.val(o),i.search=o):e.search&&this.$els.search.val(e.search),a?(this.currentGroup=a,i.group=a):e.group&&(this.currentGroup=e.group),localStorage.setItem(this.storageKeys.settings,JSON.stringify(i))},handleLayoutToggle(e){const t=$(e.currentTarget),s=t.data("layout");this.$els.layoutButtons.removeClass(this.classes.active),t.addClass(this.classes.active),this.$els.modulesContainer.removeClass(`${this.classes.grid} ${this.classes.list}`).addClass("wpext-modules--"+s);const o=this.getStoredSettings();o.layout=s,localStorage.setItem(this.storageKeys.settings,JSON.stringify(o))},handleGroupClick(e){e.preventDefault();const t=$(e.currentTarget),s=new URL(t.attr("href")).searchParams.get("group"),o=new URLSearchParams(window.location.search).get("group");if(this.$els.groupNav.find(".wpext-nav__item").removeClass(this.classes.navItemActive),t.parent().addClass(this.classes.navItemActive),o&&s!==o){const e=new URL(window.location);"all-modules"===s&&e.searchParams.delete("group"),window.history.replaceState({},"",e)}this.currentGroup=s,this.saveFilters(),this.applyFilters()},updateGroupUI(){this.$els.groupNav.find(".wpext-nav__item").removeClass(this.classes.navItemActive),"all-modules"===this.currentGroup?this.$els.groupNav.find('.wpext-nav__item-link[href*="all-modules"]').parent().addClass(this.classes.navItemActive):this.$els.groupNav.find(`.wpext-nav__item-link[href*="group=${this.currentGroup}"]`).parent().addClass(this.classes.navItemActive)},restoreLayout(){"list"===this.getStoredSettings().layout&&this.$els.layoutButtons.filter('[data-layout="list"]').trigger("click")},applyFilters(){const e=this.$els.search.val().toLowerCase(),t=this.$els.status.val();let s=0,o=0;const a=[];this.$els.modules.each(((i,l)=>{const r=$(l),n=r.data("module-id"),c=wpextended_modules.modulesSearch[n],u=r.find(this.selectors.checkbox).is(":checked"),h=r.hasClass(this.classes.modulesPro),d=r.data("group"),g=e.split(/\s+/).filter(Boolean),p=!e||g.every((e=>c.includes(e))),m="all"===t||"active"===t&&u||"inactive"===t&&!u||"free"===t&&!h||"pro"===t&&h,w="all-modules"===this.currentGroup||((v=d)?v.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""):"")===this.currentGroup;var v;w&&o++,p&&m&&w&&(a.push(r),s++)})),this.$els.modules.removeClass(`${this.classes.fadeIn} ${this.classes.fadeOut}`).css("--stagger-delay","0s"),this.$els.modules.addClass(this.classes.fadeOut),setTimeout((()=>{this.$els.modules.hide(),requestAnimationFrame((()=>{a.forEach(((e,t)=>{e.show(),requestAnimationFrame((()=>{const s=50*t/1e3;e.css("--stagger-delay",s+"s"),e.removeClass(this.classes.fadeOut).addClass(this.classes.fadeIn),setTimeout((()=>{e.removeClass(this.classes.fadeIn)}),300+1e3*s)}))})),this.$els.noModules.toggle(0===s),this.$els.liveRegion.text(1===s?"1 module shown":s+" modules shown"),this.$els.currentCount.text(s),this.$els.totalCount.text(o)}))}),300)},showNotice(e,t="success"){switch(t){case"success":window.notify.success(e);break;case"error":window.notify.error(e,{persistent:!0});break;case"warning":window.notify.warning(e);break;default:window.notify.info(e)}},toggleSearchClear(){const e=this.$els.search.val().length>0;this.$els.searchClear.toggle(e);const t=new URLSearchParams(window.location.search).get("search"),s=this.$els.search.val();if(t&&s!==t){const e=new URL(window.location.href);e.searchParams.delete("search"),window.history.replaceState({},"",e)}}};$(document).ready((()=>e.init()))}(jQuery);