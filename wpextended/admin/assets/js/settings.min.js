!function(){"use strict";class t{constructor(){this.restUrl=(wpextSettings&&wpextSettings.restUrl?wpextSettings.restUrl:"").replace(/\/$/,""),this.i18n=wpextSettings&&wpextSettings.i18n||{},this.selectedFile=null,this.exportButton=document.getElementById("export_button"),this.importButton=document.getElementById("import_button"),this.importFileTrigger=document.querySelector(".wpext-import__button"),this.importFileInput=document.getElementById("import_file")||document.querySelector(".wpext-file-input")}init(){this.bindExport(),this.bindImport()}notify(t,e){if(window.notify&&e)return"success"===t&&this.i18n[e]?window.notify.success(this.i18n[e]):"error"===t&&this.i18n[e]?window.notify.error(this.i18n[e]):"info"===t&&this.i18n[e]?window.notify.info(this.i18n[e]):"success"===t?window.notify.success(e):"error"===t?window.notify.error(e):"info"===t?window.notify.info(e):void 0}getIncludeOptions(){const t='[name="'+(window.wpextendedOptionName||"wpextended__global_settings")+'[export_include_options][]"]',e=document.querySelectorAll(t);if(!e||!e.length)return["global","modules"];const i=[];return e.forEach((t=>{t.checked&&i.push(t.value)})),i.length?i:["global","modules"]}isValidFile(t){return!(!t||"number"!=typeof t.size||0>=t.size)}buildExportUrl(t){let e=this.restUrl+"/settings/export";return t&&t.length&&(e+="?"+t.map((t=>"include[]="+encodeURIComponent(t))).join("&")),e}download(t,e){const i=new Blob([t],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(i),n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(n.href)}bindExport(){this.exportButton&&this.exportButton.addEventListener("click",(t=>{t.preventDefault(),this.onExportClick()}))}onExportClick(){const t=this.getIncludeOptions(),e=this.buildExportUrl(t);fetch(e,{credentials:"same-origin",headers:{"X-WP-Nonce":wpextSettings&&wpextSettings.nonce||""}}).then((t=>{if(!t.ok)throw Error(t.status+"");return t.text()})).then((t=>{const e="wpextended-settings-export-"+(new Date).toISOString().slice(0,10)+".json";this.download(t,e),this.notify("success","exportSuccess")})).catch((()=>this.notify("error","exportFailed")))}bindImport(){this.importFileTrigger&&this.importFileInput&&this.importFileTrigger.addEventListener("click",(t=>{t.preventDefault(),this.importFileInput.click()})),this.importFileInput&&this.importFileInput.addEventListener("change",(t=>{t.stopImmediatePropagation();const e=this.importFileInput.files&&this.importFileInput.files[0];if(e){if(!this.isValidFile(e))return this.notify("error","Selected file is empty"),this.selectedFile=null,void(this.importFileInput.value="");this.selectedFile=e,this.notify("info",e.name+" selected")}})),this.importButton&&this.importFileInput&&this.importButton.addEventListener("click",(t=>{t.preventDefault(),this.selectedFile?this.isValidFile(this.selectedFile)?this.importSelectedFile():this.notify("error","Selected file is empty"):this.notify("error","Please select a file first")}))}importSelectedFile(){const t=new FileReader;t.onload=t=>{try{const e=t.target.result,i=this.restUrl+"/settings/import";this.notify("info","importing"),fetch(i,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":wpextSettings&&wpextSettings.nonce||""},body:e}).then((t=>{if(!t.ok)throw Error(t.status+"");return t.json()})).then((()=>this.notify("success","importSuccess"))).catch((()=>this.notify("error","importFailed"))).finally((()=>{this.selectedFile=null,this.importFileInput.value=""}))}catch(t){this.notify("error","importFailed")}},t.readAsText(this.selectedFile)}}function e(){const e=new t;e.init(),window.wpextendedSettings=e}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}();